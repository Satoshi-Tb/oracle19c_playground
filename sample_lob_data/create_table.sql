-- テーブル作成

DROP SEQUENCE SEQ_T_LOB_DETAIL;
CREATE SEQUENCE SEQ_T_LOB_DETAIL START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999 NOCYCLE NOCACHE;

DROP TABLE T_LOB_HEADER CASCADE CONSTRAINTS;
DROP TABLE T_LOB_DETAIL CASCADE CONSTRAINTS;

CREATE TABLE T_LOB_HEADER (
  ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  TEXT CLOB,
  TEXT_LEN NUMBER,
  FRAGMENT_COUNT NUMBER,
  CONSTRAINT PK_T_LOB_HEADER PRIMARY KEY (ID)
);
CREATE INDEX CTX1_T_LOB_HEADER ON T_LOB_HEADER(TEXT) INDEXTYPE IS CTXSYS.CONTEXT;


CREATE TABLE T_LOB_DETAIL (
  ID NUMBER DEFAULT SEQ_T_LOB_DETAIL.NEXTVAL NOT NULL,
  HEADER_ID NUMBER,
  NO NUMBER,
  FRAGMENT CLOB,
  FRAGMENT_LEN NUMBER,
  MEMO VARCHAR2(255),
  CONSTRAINT PK_T_LOB_DETAIL PRIMARY KEY (ID),
  CONSTRAINT UK1_T_LOB_DETAIL UNIQUE (HEADER_ID, NO),
  CONSTRAINT FK_T_LOB_DETAIL_HEADER_ID FOREIGN KEY (HEADER_ID)
    REFERENCES T_LOB_HEADER (ID)
);
CREATE INDEX IDX1_T_LOB_HEADER ON T_LOB_DETAIL (HEADER_ID);
CREATE INDEX IDX2_T_LOB_HEADER ON T_LOB_DETAIL (MEMO);
CREATE INDEX CTX1_T_LOB_DETAIL ON T_LOB_DETAIL(FRAGMENT) INDEXTYPE IS CTXSYS.CONTEXT;

EXIT;